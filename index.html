<!--\n  Visualizador de RendimentoÂ â€¢Â EdiÃ§Ã£oÂ macOS 2025â€‘04â€‘17\n  ----------------------------------------------------------------------\n  â€¢ Carrega manifestos (index.json) diretamente do GitHubÂ Pages/raw.\n  â€¢ Detecta basePath no manifesto ou usa caminho relativo.\n  â€¢ ComparaÃ§Ã£o multiâ€‘dias / multiâ€‘meses / anoâ€‘aâ€‘ano para um Ãºnico turno ou entre turnos.\n  â€¢ Suporte a rendimentoIndustrial + meta fixa 81.600Â %.\n  â€¢ Interface inspirada no macOS SonomaÂ â€” neutra, polida, sem cores infantis.\n  ----------------------------------------------------------------------\n  Estrutura index.json (exemplo):\n  {\n    "basePath": "https://raw.githubusercontent.com/usuario/repositorio/main/", // opcional\n    "arquivos": [\n      "segunda.14.04.25.turno1.json",\n      "mensal.04.25.turno2.json", ...\n    ]\n  }\n  ----------------------------------------------------------------------\n-->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Rendimentoâ€¯Analyzer</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
<style>
 :root{
  --bg:#f0f2f5;--panel:#ffffff;--hover:#e5e5e5;--active:#d0d0d0;--accent:#007aff;--border:#d0d0d0;--text:#1c1c1e;--muted:#636366;--positive:#26a269;--negative:#ff453a;
  --radius:10px;--shadow:0 1px 3px rgba(0,0,0,.12);
 }
 html[data-theme="dark"]{
  --bg:#1c1c1e;--panel:#2c2c2e;--hover:#3a3a3c;--active:#48484a;--accent:#0a84ff;--border:#3a3a3c;--text:#f2f2f7;--muted:#8e8e93;--positive:#30d158;--negative:#ff375f;
 }
 body{margin:0;font-family:'Inter',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto; background:var(--bg);color:var(--text);}
 h1{font-size:20px;margin:0;padding:14px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px;}
 .wrapper{max-width:1400px;margin:24px auto;background:var(--panel);box-shadow:var(--shadow);border-radius:var(--radius);overflow:hidden;}
 /* Toolbar */
 .toolbar{display:flex;gap:8px;padding:10px 16px;border-bottom:1px solid var(--border);flex-wrap:wrap;}
 .segmented{display:inline-flex;border:1px solid var(--border);border-radius:8px;overflow:hidden;}
 .segmented button{padding:6px 14px;font-size:14px;background:none;border:none;color:var(--text);}
 .segmented button:hover{background:var(--hover);} .segmented button.active{background:var(--accent);color:#fff;}
 button.action{background:var(--accent);color:#fff;border:none;border-radius:8px;padding:6px 14px;font-size:14px;cursor:pointer;display:flex;align-items:center;gap:6px;}
 button.action:hover{opacity:.9;} button.action.secondary{background:var(--panel);color:var(--accent);border:1px solid var(--accent);} button.action.secondary:hover{background:var(--hover);}
 /* Panels */
 #status{padding:12px 20px;font-size:14px;color:var(--muted);} #info{padding:16px 20px;border-bottom:1px solid var(--border);}
 #resultado{padding:0 20px 20px;overflow-x:auto;} table{border-collapse:collapse;width:100%;font-size:13px;margin-top:14px;}
 th,td{border:1px solid var(--border);padding:6px 10px;} th{background:var(--hover);text-align:left;}
 td.num,th.num{text-align:right;} .positivo{color:var(--positive);font-weight:600;} .negativo{color:var(--negative);font-weight:600;} .na{color:var(--muted);}
 /* Chart area */
 .charts{padding:0 20px 20px;display:flex;flex-direction:column;gap:24px;} .chartBox{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:10px;}
 /* Footer */
 .footer{display:flex;justify-content:center;padding:16px;border-top:1px solid var(--border);} 
 /* Inputs */
 .controls{display:flex;gap:10px;flex-wrap:wrap;padding:16px;} .controls select,.controls input{padding:6px 10px;border:1px solid var(--border);border-radius:6px;font-size:14px;background:var(--panel);color:var(--text);} .hidden{display:none !important;}
</style>
</head>
<body>
<div class="wrapper">
 <h1>ðŸ“ˆÂ RendimentoÂ Analyzer</h1>
 <div class="toolbar" id="toolbarMain">
  <div class="segmented" id="segmentTurno">
   <button data-turno="turno1" class="active">T1</button>
   <button data-turno="turno2">T2</button>
  </div>
  <button class="action secondary" id="btnDia">Dia</button>
  <button class="action secondary" id="btnDias">DiasÂ (2)</button>
  <button class="action secondary" id="btnMes">MÃªs</button>
  <button class="action secondary" id="btnMeses">MesesÂ (2)</button>
  <button class="action secondary" id="btnAno">AnoÂ Ã—Â Ano</button>
  <button class="action" id="btnExport">ExportarÂ PDF</button>
  <button class="action secondary" id="btnTheme">ðŸŒ“</button>
 </div>
 <div class="controls hidden" id="controlsDia">
   <label>DataÂ 1Â <input type="date" id="data1"></label>
   <label class="hidden" id="lblData2">DataÂ 2Â <input type="date" id="data2"></label>
   <button class="action" id="btnLoadDia">Carregar</button>
 </div>
 <div class="controls hidden" id="controlsMes">
   <select id="ano1"></select><select id="mes1"></select>
   <label class="hidden" id="lblMes2"><select id="ano2"></select><select id="mes2"></select></label>
   <button class="action" id="btnLoadMes">Carregar</button>
 </div>
 <p id="status"></p>
 <div id="info" class="hidden"></div>
 <div id="resultado"></div>
 <div class="charts hidden" id="charts">
  <div class="chartBox"><canvas id="chartProdutos"></canvas></div>
  <div class="chartBox" id="chartIndustrialBox" style="display:none;"><canvas id="chartIndustrial"></canvas></div>
 </div>
 <div class="footer">Â©Â 2025Â AdrianoÂ Tools</div>
</div>
<script>
const META_INDUSTRIAL=81.600; let basePath=""; let manifest={}; let arquivos=[];
const $$=q=>document.querySelector(q); const $$$=q=>Array.from(document.querySelectorAll(q));
function setStatus(t){$('#status').textContent=t||'';}
function $(sel){return document.querySelector(sel);} // shortcut
// THEME
$('#btnTheme').onclick=()=>{const h=document.documentElement;h.dataset.theme=h.dataset.theme==='dark'?'light':'dark';};
// LOAD MANIFEST
(async()=>{try{setStatus('ðŸ”„Â Carregando manifestâ€¦');const r=await fetch('index.json');manifest=await r.json();arquivos=manifest.arquivos||[];basePath=manifest.basePath||'';setStatus('');preencherMesAno();}catch(e){setStatus('Erro ao carregar index.json');console.error(e);}})();
// UTILS de nome de arquivo
function fileDia(dateISO,turno){const d=new Date(dateISO+'T00:00:00Z');const dia=d.toLocaleDateString('pt-BR',{weekday:'long',timeZone:'UTC'}).toLowerCase().replace('terÃ§a','terca').replace('sÃ¡bado','sabado');const dd=String(d.getUTCDate()).padStart(2,'0');const mm=String(d.getUTCMonth()+1).padStart(2,'0');const aa=String(d.getUTCFullYear()).slice(2);return `${dia}.${dd}.${mm}.${aa}.${turno}.json`;}
function fileMensal(mes,ano,turno){const mm=String(mes).padStart(2,'0');const aa=String(ano).slice(2);return `mensal.${mm}.${aa}.${turno}.json`;}
function tituloMes(m,a){return new Date(a,m-1,1).toLocaleString('pt-BR',{month:'long'}).replace(/^./,c=>c.toUpperCase())+'/'+a;}
function cor(turno){return turno==='turno1'?'rgba(52,120,246,.7)':'rgba(48,209,88,.7)';}
let chartP=null,chartI=null;function clearCharts(){if(chartP){chartP.destroy();chartP=null} if(chartI){chartI.destroy();chartI=null;$('#chartIndustrialBox').style.display='none';}}
// PREENCHE SELECT ANOS/MESES
function preencherMesAno(){const anos=[...new Set(arquivos.filter(a=>a.startsWith('mensal')).map(a=>2000+parseInt(a.split('.')[2])))].sort((a,b)=>b-a);['#ano1','#ano2'].forEach(id=>{const sel=$(id);sel.innerHTML='<option value="">Ano</option>'+anos.map(y=>`<option>${y}</option>`).join('');});const meses='<option value="">MÃªs</option>'+[...Array(12).keys()].map(i=>`<option value="${i+1}">${i+1}</option>`).join('');['#mes1','#mes2'].forEach(id=>$(id).innerHTML=meses);}
// SEGMENTED TURNOS
$('#segmentTurno').addEventListener('click',e=>{if(e.target.tagName!=='BUTTON')return;$$$('#segmentTurno button').forEach(b=>b.classList.remove('active'));e.target.classList.add('active');});
function turnoAtivo(){return $('#segmentTurno .active').dataset.turno;}
// TOOLBAR BUTTONS
function hideAllControls(){['#controlsDia','#controlsMes'].forEach(s=>$(s).classList.add('hidden'));}
$('#btnDia').onclick=()=>{hideAllControls();$('#lblData2').classList.add('hidden');$('#controlsDia').classList.remove('hidden');};
$('#btnDias').onclick=()=>{hideAllControls();$('#lblData2').classList.remove('hidden');$('#controlsDia').classList.remove('hidden');};
$('#btnMes').onclick=()=>{hideAllControls();$('#lblMes2').classList.add('hidden');$('#controlsMes').classList.remove('hidden');};
$('#btnMeses').onclick=()=>{hideAllControls();$('#lblMes2').classList.remove('hidden');$('#controlsMes').classList.remove('hidden');};
$('#btnAno').onclick=()=>{hideAllControls();$('#lblMes2').classList.remove('hidden');$('#controlsMes').classList.remove('hidden');};
// LOAD BUTTON EVENTS
$('#btnLoadDia').onclick=async()=>{const d1=$('#data1').value;const d2=$('#data2').value;const multi=$('#lblData2').classList.contains('hidden')?false:true; if(!d1||(multi&&!d2)){alert('Preencha as datas');return;} const turno=turnoAtivo();let files=[fileDia(d1,turno)];if(multi)files.push(fileDia(d2,turno)); await processar(files,multi?['Dia 1','Dia 2']:[d1]);};
$('#btnLoadMes').onclick=async()=>{const a1=$('#ano1').value,m1=$('#mes1').value;if(!a1||!m1){alert('Selecione ano e mÃªs');return;}const turno=turnoAtivo();const multi=!$('#lblMes2').classList.contains('hidden');let files=[fileMensal(m1,a1,turno)];let labels=[tituloMes(m1,a1)]; if(multi){const a2=$('#ano2').value,m2=$('#mes2').value;if(!a2||!m2){alert('Selecione o segundo mÃªs/ano');return;}files.push(fileMensal(m2,a2,turno)); labels.push(tituloMes(m2,a2));} await processar(files,labels,true);
};
// PROCESSAR
async function processar(files,labels,isMensal=false){try{setStatus('Carregando dadosâ€¦');clearCharts();$('#info').classList.add('hidden');$('#resultado').innerHTML='';
 const dados=await Promise.all(files.map(f=>{if(!arquivos.includes(f))throw`Arquivo nÃ£o listado: ${f}`;return fetch(basePath+f).then(r=>{if(!r.ok)throw`404 ${f}`;return r.json();});}));
 // MONTAR TABELA
 const produtos=[...new Set(dados.flatMap(d=>d.itens.map(i=>i.produto)))];
 let html='<table><thead><tr><th>Produto</th>';
 if(dados.length===1){html+='<th>Meta %</th><th>Realizado %</th><th>Dif %</th><th>Kg</th><th>Cx</th></tr></thead><tbody>';}else{html+=`<th>${labels[0]} %</th><th>${labels[1]} %</th><th>Dif %</th><th>Dif Kg</th><th>Dif Cx</th></tr></thead><tbody>`;}
 let metaArr=[],v1=[],v2=[];
 produtos.forEach(p=>{const d1=dados[0].itens.find(i=>i.produto===p)||{};const d2=dados[1]?dados[1].itens.find(i=>i.produto===p)||{}:{};const meta=d1.meta||d2.meta||0;const r1=+d1.realizado||0;const r2=dados[1]?+d2.realizado||0:0;metaArr.push(meta);v1.push(r1);if(dados.length>1)v2.push(r2);
 html+='<tr><td>'+p+'</td>';
 if(dados.length===1){const diff=r1-meta;const cls=diff>0?'positivo':diff<0?'negativo':'na';html+=`<td>${meta.toFixed(3)}%</td><td>${r1.toFixed(3)}%</td><td class="${cls}">${diff.toFixed(3)}%</td><td>${(+d1.quilos||0).toFixed(2)}</td><td>${Math.round(+d1.caixas||0)}</td>`;}else{const diff=r2-r1;const cls=diff>0?'positivo':diff<0?'negativo':'na';html+=`<td>${r1.toFixed(3)}%</td><td>${r2.toFixed(3)}%</td><td class="${cls}">${diff.toFixed(3)}%</td><td class="${cls}">${((+d2.quilos||0)-(+d1.quilos||0)).toFixed(2)}</td><td class="${cls}">${(Math.round(+d2.caixas||0)-Math.round(+d1.caixas||0))}</td>`;} html+='</tr>';});html+='</tbody></table>';
 $('#resultado').innerHTML=html;$('#info').classList.remove('hidden');$('#info').innerHTML=`<strong>${labels.join(' x ')}</strong>`;
 // CHARTS
 const ctx=$('#chartProdutos').getContext('2d');const ds=[{label:'Meta %',data:metaArr,backgroundColor:'rgba(255,159,64,.6)'} ,{label:labels[0],data:v1,backgroundColor:cor('turno1')}]; if(dados.length>1)ds.push({label:labels[1],data:v2,backgroundColor:cor('turno2')}); chartP=new Chart(ctx,{type:'bar',data:{labels:produtos,datasets:ds},options:{responsive:true,plugins:{legend:{position:'top'},title:{display:true,text:'Meta Ã— Realizado'}}}});
 if(isMensal){$('#chartIndustrialBox').style.display='block';const ctx2=$('#chartIndustrial').getContext('2d');const ind1=dados[0].rendimentoIndustrial||0;const ind2=dados[1]?dados[1].rendimentoIndustrial:undefined;const lab=['Meta',labels[0]].concat(ind2!==undefined?[labels[1]]:[]);const dataI=[META_INDUSTRIAL,ind1].concat(ind2!==undefined?[ind2]:[]);chartI=new Chart(ctx2,{type:'bar',data:{labels:lab,datasets:[{label:'Rend.Industrial %',data:dataI,backgroundColor:['#ffa94d','#74c0fc','#8ce99a']}]},options:{plugins:{legend:{display:false},title:{display:true,text:'Rendimento Industrial'}}}});} $('#charts').classList.remove('hidden'); setStatus('');}catch(e){setStatus('Erro: '+e);console.error(e);} }
 // EXPORT PDF
 $('#btnExport').onclick=()=>{html2pdf().from(document.querySelector('.wrapper')).set({margin:.4,filename:'rendimento.pdf',image:{type:'jpeg',quality:.97},html2canvas:{scale:2},jsPDF:{unit:'in',format:'a4',orientation:'landscape'}}).save();};
</script>
</body>
</html>
